# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

Используемый паттерн проектирования
Проект реализован на основе паттерна MVP. Взаимодействие между Моделью и Представлением реализовано через события пользователя.

Основные классы

Класс
Api
Базовый класс для отправки и получения запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля:
baseUrl

- базовый адрес сервера
  options
- объект с заголовками запросов

Методы:
handleResponse

- принимает ответ от сервера как параметр, и обрабатывает его,возвращая результат в формате
  json
  или отклоненный промис с возникшей ошибкой
  get
- выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
  post
- принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется 'POST' запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

Класс EventEmitter
Классическая реализация брокера событий. Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Поля:
events

Методы:
on

- подписка на событие
  off
- отписка от события
  emit
- инициализация события
  onAll
- подписка одновременно на все события
  offAll
- сброс ВСЕХ обработчиков
  trigger
- возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

Класс
Component<T>
Абстрактный базовый класс, предназначенным для создания компонентов пользовательского интерфейса. Класс обеспечивает инструментарий для управления DOM элементами и поведением компонента. Наследуется всеми классами представления(View)

Методы:

toggleClass

- переключается класс для переданного элемента
  setText
- устанавливает текстовое содержимое для переданного элемента
  setImage
- устанавливает изображения и альтернативный текст для изоображения(опционально) для переданного элемента типа HTMLImageElement
  setDisabled
- изменяет статус блокировки для переданного элемента
  setHidden
  ,
  setVisible
- скрывает, отображает переданный элемент
  render
- рендерит компонент, используя переданные данные. Метод должен быть переназначен в дочерних классах

Класс
View<T>
Базовый класс, расширяющий класс
Component
, добавляя в него поле
events
, в которое записывается брокер событий, чтобы была возможность их генерации.

Методы: полностью наследуются от класса
Component<T>

Общие классы

Класс
PopupComponent
Реализует модальное окно. Предоставляет методы для управления состоянием окна и генерации событий (
modal:open
,
modal:close
).

Поля:
closeButton

- элемент кнопки закрытия модального окна
  content
- элемент с содержимым модального окна

Сеттеры:
content

- меняет содержимое модального окна

Методы:
open

- открывает модальное окно и эмитит ивент
  modal:open
  close
- закрывает и стирает содержимое модального окна, также эмитит ивент
  modal:close
  render
- рендерит модальное окно с переданным содержимым и открывает его

Класс
Basket
Реализует корзину. Предоставляет сеттеры для изменения отображения корзины.

Поля:

\_list - элемент содержимого корзины (карточек товаров)
\_total - элемент суммы товаров в корзине
\_button - элемент кнопки оформления заказа в корзине

Сеттеры:
items

- меняет содержимое в корзине в зависимости от переданных товаров
  total
- меняет значение в элементе суммы товаров на переданное
  selected
- переключает активность кнопки

Класс
Card
Реализует карточку товара (используется на главной, в модальном окне и в корзине).

Поля:

\_title

- элемент заголовка карточки
  \_image
- элемент картинки карточки
  \_price
- элемент цены карточки
  \_category
- элемент категории карточки
  \_description
- элемент описания карточки
  \_button
- элемент кнопки карточки

Сеттеры:
id

- принимает и задает id карточки
  title
- меняет содержимое заголовка на полученное
  price
- меняет содержимое контейнера с ценой на полученное
  category
- меняет содержимое контейнера с категорией на полученное
  image
- меняет изображение и альтернативный текст в карточке
  description
- меняет содержимое контейнера с описанием на полученное

Метод:
isEmpty

- изменяет текст кнопки

Класс
Contact
Реализует компонент формы контактов. Наследуется от класса Form.

Поля:
\_email

- инпут с имэйлом
  \_phone
- инпут с телефоном

Сеттеры:
email

- меняет содержимое поля
  email
  в форме
  phone
- меняет содержимое поля
  phone
  в форме
  valid
- блокирует кнопку, если какое то из полей не заполнено

Класс
Page
Реализует главную страницу - каталог товаров с счетчиком. Имеет набор сеттеров, отвечающих за DOM-элементы главной страницы. Генерирует событие
basket:open
при клике на кнопку корзины.

Поля:

\_counter

- элемент счетчика на странице
  \_catalog
- элемент каталога на странице
  \_wrapper
- элемент обертки на странице
  \_basket
- элемент корзины на странице

Сеттеры:
counter

- меняет содержимое счетчика на полученное
  catalog
- меняет содержмое каталога на полученные элементы
  locked
- меняет класс обертки на значение, соответствующее переданному

Класс
Success
Реализует окно с подтверждением заказа.

Поля:
\_close

- элемент кнопки закрытия окна
  \_total
- элемент с суммой заказа

Сеттеры:
total

- меняет содержимое элемента с суммой заказа

Класс
ProductApi, позволяет взаимодействовать с API продуктов

Поля:
\_cdn

Методы:

getProductList

- получает список всех продуктов
  getProductItem
- получает подробную информацию о продукте по его идентификатору
  OrderProduct
  — размещает заказ на продукт

Класс
State
управляет состоянием приложения, связанным с каталогом товаров и оформлением заказа

Поля:
catalogue

- массив товаров
  order
- Объект заказа
  FormOfderErrors
- Объект с ошибками формы заказа
  FormOfderContacts
- Объект с ошибками контактной формы

Методы:
validateContacts

-     Проверяет заполненность контактных данных и записывает ошибки в formContactsErrors
  validateOrder
- Проверяет заполненность полей заказа и записывает ошибки в formOrderErrors
  toogleOrderItem
- Добавляет или удаляет товар из заказа
  clearBasket
- Очищает корзину и обнуляет данные заказа
  total
- Считает сумму всех товаров в заказе
  isFilledFielsOrder
- Проверяет, заполнены ли поля заказа
  isFilledFielsContact
- Проверяет, заполнены ли контактные данные
  clearOrderFealds
- Очищает данные заказа
  setCatalogue
- Устанавливает каталог товаров и отправляет событие items:change
  getCards
- Возвращает массив товаров, добавленных в корзину
  setFields
- Устанавливает значение в объекте заказа и запускает валидацию

Класс
BasketItem

Поля:
index

- элемент, отражающий порядковый номер
  btn
- кнопка удаления товаров из корзины

Сеттеры:
index

- меняет число количества товаров в корзине

Класс
Form
предназначен для работы с формами и взаимодействия с состоянием приложения (IState), наследуется от Component<IState>

Поля:
\_errors

- контейнер с сообщениями об ошибках
  events
- Объект для управления событиями
  container
- Контейнер, в котором находится форма

Сеттеры:
errors

- меняет содержмое компонента с ошибками формы на переданное

Методы:
onInputChange

- эмитит событие
  order:change
  с переданными параметрами
  render
- рендерит компонент формы, используя переданное состояние
  onPaymentChange
- Отправляет событие order:change, указывая, что изменилось поле payment

Класс
Order
Реализует компонент формы отправки заказа.

Поля:
submit

- кнопка оформления заказа
  btn
- кнопка выбора оплатой наличными
  btnCard
- кнопка выбора оплатой картой

Сеттеры:
valid

- Включает/отключает кнопку "Оформить заказ"
  address
- меняет содержимое поля
  address
  в форме

Методы:
onPaymentChange

- меняет способ оплаты

Все события:

items:changed

- изменение массива товаров каталога
  basket:changed
- изменение списка товаров корзины
  formOrderErrors:change
- изменение в списке ошибок валидации формы
  formContactErrors:change
- изменение в списке ошибок валидации формы
  modal:open
- открытие любого модального окна
  modal:close
- закрытие любого модального окна
  basket:open
- открытие модального окна корзины
  card:select
- выбор карточки
  order:open
- открытие окна оформления заказа
  order:submit
- отправка формы
  order:change
- изменение поля в форме

Основные интерфейсы

**IPage**

Интерфейс `IPage` описывает страницу с каталогом продуктов. Он содержит следующие свойства:

- `counter: number` — счетчик элементов.
- `catalogue: HTMLElement[]` — массив элементов каталога.
- `locked: boolean` — флаг, указывающий, заблокирована ли страница.

**IProducts**

Интерфейс `IProducts` описывает галерею продуктов. Он содержит следующее свойство:

- `items: IProd[]` — массив элементов галереи.

**ISuccess**

Интерфейс `ISuccess` описывает результат успешной операции. Он содержит следующее свойство:

- `total: number` — общее значение.

**IProduct**

Интерфейс `IProduct` описывает продукт. Он содержит следующие свойства:

- `description?: string` — описание продукта. (необязательно)
- `id: string` — идентификатор продукта.
- `image: string` — URL изображения продукта.
- `title: string` — заголовок продукта.
- `category: string` — категория продукта.
- `price: number | null` — цена продукта.

**IOrder**

Интерфейс `IOrder` описывает заказ. Он содержит следующие свойства:

- `total: number` — общая стоимость заказа.
- `items: string[]` — массив идентификаторов продуктов в заказе.
- `payment: string` — информация о способе оплаты.
- `address: string` — информация об адресе доставки.

**IOrderForm**

`IOrderForm `взаимодействует с другими интерфейсами через наследование. В данном случае, `IOrderForm` расширяет два других интерфейса: `ContactsError` и `OrderError`. Это означает, что все свойства, объявленные в интерфейсах `ContactsError` и `OrderErros`, также становятся доступными в `IOrderForm`.

- `address?: string` — ошибка в поле адреса.
- `payment?: string` — ошибка в поле способа оплаты.
- `email?: string` — ошибка в поле адреса электронной почты.
- `phone?: string` — ошибка в поле номера телефона.

**IOrderResult**

Интерфейс `IOrderResult` описывает результат заказа. Он содержит следующие свойства:

- `id: string` — идентификатор заказа.
- `total: number` — общая стоимость заказа.

**IContact**

Интерфейс `IContact` описывает контактную информацию. Он содержит следующие свойства:

- `email: string` — адрес электронной почты.
- `phone: string` — номер телефона.

**IBasket**

Интерфейс `IBasket` описывает корзину. Он содержит следующие свойства:

- `items: HTMLElement[]` — массив продуктов в корзине.
- `total: number` — общая стоимость товаров в корзине.
- `selected: string[]` — массив идентификаторов выбранных товаров в корзине.

**OrderError**

Тип `OrderError` описывает ошибки в форме заказа. Он содержит следующие свойства:

- `address?: string` — ошибка в поле адреса.
- `payment?: string` — ошибка в поле способа оплаты.

**ContactsError**

Тип `ContactsFormErrors` описывает ошибки в форме контактов. Он содержит следующие свойства:

- `email?: string` — ошибка в поле адреса электронной почты.
- `phone?: string` — ошибка в поле номера телефона.

**IAction**

Интерфейс `IAction` описывает успешное действие. Он содержит следующее свойство:

- `onClick () => void` — функция, которая вызывается при успешном выполнении действия.

**IActionEvent**

Интерфейс `IActionEvent` описывает действие. Он содержит следующее свойство:

- `onClick (evt: MouseEvent) => void` — функция, которая вызывается при нажатии на элемент.

**IOrder**

Интерфейс `IOrder` представляет собой объединение свойств из нескольких интерфейсов, таких как `ContactsError`, `OrderError` и `IState`.

- `items: string[]` — массив идентификаторов товаров в заказе.
- `total: number` — общая стоимость заказа.

**IState**

Интерфейс `IState` описывает состояние приложения. Он содержит следующие свойства:

- `validation: boolean` — статус проверки.
- `errors: string[]` — массив сообщений об ошибках.
